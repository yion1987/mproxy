## 使用说明

### 基本功能

- **运行**：在项目根目录执行 `python main.py` 启动图形界面。
- **代理服务配置**：
  - `监听地址`：默认 `0.0.0.0`，代理服务绑定的IP地址。
  - `监听端口`：默认 `1080`，代理服务监听的端口。
  - `上游代理地址/端口`（可选）：如需级联到上游 SOCKS5 代理，则填入；不填则直接连接目标地址。
  - `连接超时(秒)`：默认 `10`，连接目标服务器的超时时间，适用于代理和端口转发。
  - `协议`：支持 `SOCKS5` 和 `HTTP` 代理协议。

### 端口转发功能

- **启用端口转发**：勾选"启用端口转发"复选框来开启端口转发功能。
- **管理转发规则**：
  - `添加规则`：添加新的端口转发规则。
  - `编辑规则`：修改选中的转发规则。
  - `删除规则`：删除选中的转发规则。
- **转发规则配置**：
  - `转发端口`：本地监听的端口，范围 1-65535。
  - `目标主机`：要转发到的目标服务器地址（支持IP地址和域名）。
  - `目标端口`：目标服务器的端口，范围 1-65535。
- **状态显示**：实时显示每个转发规则的运行状态（运行中/已停止/启动失败/端口冲突）。

### 操作控制

- **启动/停止**：点击 `启动` 开始所有服务，`停止` 关闭所有服务。
- **配置保存**：启动时自动保存当前配置到 `config.json` 文件。
- **界面响应**：启动过程在后台线程执行，确保界面始终保持响应。
- **日志窗口**：黑色背景的终端样式，实时显示服务运行日志。

## 打包为可执行文件（Windows）

1. **环境准备**：确保已创建虚拟环境并安装依赖（脚本会自动安装 pyinstaller）。
2. **执行打包**：在项目根目录执行：
   ```powershell
   powershell -ExecutionPolicy Bypass -File scripts/build.ps1 -Name mproxy
   ```
3. **打包说明**：
   - 脚本会自动生成 `assets/icon.ico`（应用图标）。
   - 使用 `pyinstaller` 将Python代码打包为单个可执行文件。
   - 生成的可执行文件位于 `dist/` 目录。
   - 打包后的程序可在没有Python环境的Windows系统上运行。

## 技术特性

### 代理协议支持
- **SOCKS5 代理**：完整支持 SOCKS5 协议，包括 `CONNECT` 命令。
- **HTTP 代理**：支持 HTTP CONNECT 方法进行隧道代理。
- **地址类型**：支持 IPv4、IPv6 地址和域名解析。
- **上游级联**：支持通过上游 SOCKS5 代理进行级联转发（无认证）。

### 端口转发特性
- **TCP 转发**：支持任意 TCP 端口的转发功能。
- **多规则管理**：可同时配置多个端口转发规则。
- **状态监控**：实时监控每个转发规则的运行状态。
- **错误处理**：详细的连接错误分类和日志记录。
- **超时控制**：统一的连接超时设置，适用于所有转发规则。

### 界面优化
- **响应式设计**：后台线程处理，确保界面始终响应。
- **配置持久化**：自动保存和加载配置文件。
- **实时日志**：彩色终端样式的实时日志显示。
- **错误提示**：友好的错误提示和状态反馈。

## 使用场景

1. **网络代理**：作为 SOCKS5/HTTP 代理服务器使用。
2. **端口转发**：将本地端口转发到远程服务器。
3. **开发调试**：本地开发环境的网络调试工具。
4. **服务中转**：在不同网络环境间建立服务连接。