# MPROXY - 多协议代理工具

一个功能强大的图形化代理工具，支持 SOCKS5/HTTP 代理和 TCP 端口转发功能。

## 功能特性

### 🚀 代理服务
- **SOCKS5 代理**：完整支持 SOCKS5 协议，包括 CONNECT 命令
- **HTTP 代理**：支持 HTTP CONNECT 方法进行隧道代理
- **上游级联**：支持通过上游 SOCKS5 代理进行级联转发
- **多地址支持**：IPv4、IPv6 地址和域名解析

### 🔄 端口转发
- **TCP 转发**：支持任意 TCP 端口的转发功能
- **多规则管理**：可同时配置多个端口转发规则
- **实时状态**：监控每个转发规则的运行状态
- **智能错误处理**：详细的连接错误分类和日志记录

### 🎨 用户界面
- **图形化界面**：基于 Tkinter 的直观操作界面
- **响应式设计**：后台线程处理，确保界面始终响应
- **实时日志**：彩色终端样式的实时日志显示
- **配置持久化**：自动保存和加载配置文件

## 快速开始

### 环境要求
- Python 3.8+
- Windows 操作系统（推荐）

### 安装运行

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd mproxy
   ```

2. **创建虚拟环境**
   ```bash
   python -m venv .venv
   .venv\Scripts\activate
   ```

3. **运行程序**
   ```bash
   python main.py
   ```

## 使用说明

### 代理服务配置

1. **基本设置**
   - `监听地址`：默认 `0.0.0.0`，代理服务绑定的IP地址
   - `监听端口`：默认 `1080`，代理服务监听的端口
   - `连接超时`：默认 `10` 秒，连接目标服务器的超时时间
   - `协议选择`：支持 `SOCKS5` 和 `HTTP` 代理协议

2. **上游代理**（可选）
   - `上游代理地址`：上游 SOCKS5 代理服务器地址
   - `上游代理端口`：上游代理服务器端口
   - 不填写则直接连接目标地址

### 端口转发配置

1. **启用功能**
   - 勾选"启用端口转发"复选框

2. **管理规则**
   - `添加规则`：创建新的端口转发规则
   - `编辑规则`：修改选中的转发规则
   - `删除规则`：删除选中的转发规则

3. **规则参数**
   - `转发端口`：本地监听端口（1-65535）
   - `目标主机`：目标服务器地址（IP或域名）
   - `目标端口`：目标服务器端口（1-65535）

### 服务控制

- **启动服务**：点击"启动"按钮开始所有配置的服务
- **停止服务**：点击"停止"按钮关闭所有运行中的服务
- **状态监控**：实时查看服务运行状态和日志信息

## 打包部署

### 生成可执行文件

1. **执行打包脚本**
   ```powershell
   powershell -ExecutionPolicy Bypass -File scripts/build.ps1 -Name mproxy
   ```

2. **获取结果**
   - 可执行文件位于 `dist/` 目录
   - 可在无 Python 环境的 Windows 系统运行

## 使用场景

### 🌐 网络代理
- 作为本地 SOCKS5/HTTP 代理服务器
- 通过上游代理实现网络访问控制
- 开发环境的网络调试工具

### 🔗 端口转发
- 将本地端口转发到远程服务器
- 在不同网络环境间建立服务连接
- 绕过网络限制访问内部服务

### 🛠️ 开发调试
- 本地开发环境的网络工具
- API 接口调试和测试
- 网络连接问题排查

## 技术架构

### 核心组件
- **代理服务器**：`Socks5Server` 和 `HTTPProxyServer`
- **端口转发**：`PortForwardServer`
- **图形界面**：基于 `Tkinter` 的 GUI 应用
- **配置管理**：JSON 格式的配置文件

### 关键特性
- **多线程处理**：每个连接使用独立线程处理
- **异步启动**：后台线程启动服务，避免界面阻塞
- **错误恢复**：完善的异常处理和错误提示
- **资源管理**：自动清理连接和线程资源

## 配置文件

程序会自动创建 `config.json` 配置文件：

```json
{
  "protocol": "SOCKS5",
  "bind_host": "0.0.0.0",
  "bind_port": 1080,
  "upstream_host": "",
  "upstream_port": 1080,
  "timeout": 10,
  "forward_enabled": false,
  "forward_rules": []
}
```

## 故障排除

### 常见问题

1. **端口被占用**
   - 检查端口是否被其他程序使用
   - 尝试使用其他端口号

2. **连接超时**
   - 检查网络连接
   - 调整超时时间设置
   - 验证目标地址和端口

3. **权限问题**
   - 某些端口可能需要管理员权限
   - 尝试以管理员身份运行

### 日志分析
- 查看实时日志窗口获取详细错误信息
- 日志包含连接状态、错误类型和处理结果

## 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目！

---

**注意**：本工具仅供学习和合法用途使用，请遵守当地法律法规。